<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Notion-matching colors */
        body { background-color: #ffffff; color: #37352f; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; }
        .notion-shadow { box-shadow: rgba(15, 15, 15, 0.1) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 2px 4px; border-radius: 8px; }
        .google-style { border-radius: 24px; border: 1px solid #e1e1e1; box-shadow: 0 1px 6px rgba(32,33,36,0.2); }
    </style>
</head>
<body class="p-4 flex flex-col items-center">
    <div class="w-full max-w-2xl relative">
        <input id="goalInput" type="text" placeholder="‚ú® Type a goal to engineer your life..." 
               class="google-style w-full p-3 px-10 outline-none focus:shadow-lg transition text-lg">
        <span class="absolute left-3 top-4 text-gray-400">üîç</span>
    </div>

    <div id="loading" class="hidden mt-4 text-sm text-gray-400 animate-pulse">Brainstorming building blocks...</div>

    <div id="results" class="hidden mt-4 w-full max-w-2xl notion-shadow p-6 bg-black text-left">
        <h3 class="font-semibold text-gray-500 text-xs uppercase tracking-widest mb-4">Suggested Action Plan</h3>
        <div id="taskList" class="space-y-3 mb-6"></div>
        
        <div class="flex flex-wrap gap-3 mb-6">
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 font-bold uppercase ml-1 mb-1">Priority</span>
                <select id="priority" class="p-2 bg-gray-50 border border-gray-200 rounded text-sm outline-none">
                    <option>üî• High</option><option>‚ö° Med</option><option>‚òï Low</option>
                </select>
            </div>
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 font-bold uppercase ml-1 mb-1">Target Date</span>
                <input id="deadline" type="date" class="p-2 bg-gray-50 border border-gray-200 rounded text-sm outline-none">
            </div>
        </div>
        
        <button onclick="addToNotion()" class="w-full bg-[#2383e2] text-white font-medium py-2 rounded hover:bg-[#0077d4] transition">
            Add to lvcky System
        </button>
    </div>

    <script>
        const input = document.getElementById('goalInput');
        input.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                document.getElementById('loading').classList.remove('hidden');
                document.getElementById('results').classList.add('hidden');
                const res = await fetch('/suggest-tasks', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ goal: input.value })
                });
                const data = await res.json();
                renderTasks(data.tasks);
            }
        });

        function renderTasks(tasks) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            const list = document.getElementById('taskList');
            list.innerHTML = tasks.map(t => `
                <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded transition group">
                    <input type="checkbox" checked value="${t}" class="w-4 h-4 rounded accent-[#2383e2]">
                    <span class="text-sm text-gray-700">${t}</span>
                </div>
            `).join('');
        }

        async function addToNotion() {
            const selectedTasks = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(c => c.value);
            const btn = event.target;
            btn.innerText = "Syncing...";
            
            const res = await fetch('/add-to-notion', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    goal: input.value,
                    tasks: selectedTasks,
                    priority: document.getElementById('priority').value,
                    deadline: document.getElementById('deadline').value
                })
            });
            if (res.ok) {
                btn.innerText = "‚úÖ Added to LifeOS";
                setTimeout(() => {
                    document.getElementById('results').classList.add('hidden');
                    input.value = "";
                    btn.innerText = "Add to lvcky System";
                }, 2000);
            }
        }
    </script>
</body>
</html>